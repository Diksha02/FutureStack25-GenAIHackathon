<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskPilot - Settings</title>
    <link rel="stylesheet" href="./css/settings.css">
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">
          <span class="logo-icon">üèÜ</span>
          <h1>TaskPilot</h1>
        </div>
        <nav>
          <a href="index.html">Plan</a>
          <a href="today.html">Today</a>
          <a href="tasks.html">Tasks</a>
          <a href="focus.html">Focus</a>
          <a href="settings.html" class="active">Settings</a>
        </nav>
      </header>

      <div class="settings-grid">
        <div class="card">
          <h2>üìä Your Statistics</h2>
          <div class="stats-overview">
            <div class="stat-box">
              <div class="stat-value" id="totalSessions">0</div>
              <div class="stat-label">Total Sessions</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="totalFocusTime">0h</div>
              <div class="stat-label">Total Focus Time</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="totalTasks">0</div>
              <div class="stat-label">Tasks Completed</div>
            </div>
          </div>
          <button class="btn-secondary" onclick="resetStats()">
            <span>‚Ü∫</span>
            <span>Reset Statistics</span>
          </button>
        </div>

        <div class="card">
          <h2>‚öôÔ∏è General Settings</h2>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Timezone</div>
              <div class="setting-description">
                Set your local timezone for accurate scheduling
              </div>
            </div>
            <div class="setting-control">
              <select id="timezone">
                <option value="UTC">UTC</option>
                <option value="America/New_York">Eastern Time</option>
                <option value="America/Chicago">Central Time</option>
                <option value="America/Denver">Mountain Time</option>
                <option value="America/Los_Angeles">Pacific Time</option>
                <option value="Europe/London">London</option>
                <option value="Europe/Paris">Paris</option>
                <option value="Asia/Tokyo">Tokyo</option>
                <option value="Asia/Kolkata">India</option>
              </select>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Theme</div>
              <div class="setting-description">
                Choose your preferred color theme
              </div>
            </div>
            <div class="setting-control">
              <select id="theme">
                <option value="default">Default Purple</option>
                <option value="blue">Ocean Blue</option>
                <option value="green">Forest Green</option>
                <option value="orange">Sunset Orange</option>
              </select>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Notifications</div>
              <div class="setting-description">
                Enable browser notifications for task reminders
              </div>
            </div>
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" id="notifications" checked />
                <span class="slider"></span>
              </label>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Sound Effects</div>
              <div class="setting-description">
                Play sounds when timer completes
              </div>
            </div>
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" id="sounds" checked />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>üéØ Focus Settings</h2>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Default Focus Duration</div>
              <div class="setting-description">
                Default length for focus sessions (minutes)
              </div>
            </div>
            <div class="setting-control">
              <input
                type="number"
                id="focusDuration"
                value="25"
                min="5"
                max="120"
              />
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Break Duration</div>
              <div class="setting-description">
                Length of breaks between sessions (minutes)
              </div>
            </div>
            <div class="setting-control">
              <input
                type="number"
                id="breakDuration"
                value="5"
                min="1"
                max="30"
              />
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Auto-start Breaks</div>
              <div class="setting-description">
                Automatically start break timer after focus session
              </div>
            </div>
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" id="autoBreak" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>üíæ Data Management</h2>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Export Data</div>
              <div class="setting-description">
                Download all your tasks and settings as JSON
              </div>
            </div>
            <div class="setting-control">
              <button class="btn-primary" onclick="exportData()">
                <span>üì•</span>
                <span>Export</span>
              </button>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-label">Import Data</div>
              <div class="setting-description">
                Restore tasks and settings from JSON file
              </div>
            </div>
            <div class="setting-control">
              <input
                type="file"
                id="importFile"
                accept=".json"
                style="display: none"
                onchange="importData()"
              />
              <button
                class="btn-primary"
                onclick="document.getElementById('importFile').click()"
              >
                <span>üì§</span>
                <span>Import</span>
              </button>
            </div>
          </div>

          <div class="danger-zone">
            <h3>‚ö†Ô∏è Danger Zone</h3>
            <p style="margin-bottom: 15px; color: #742a2a">
              These actions cannot be undone.
            </p>
            <div class="button-group">
              <button class="btn-danger" onclick="clearAllData()">
                <span>üóëÔ∏è</span>
                <span>Clear All Data</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="alert alert-success" id="successAlert">
        ‚úÖ Settings saved successfully!
      </div>

      <div class="alert alert-error" id="errorAlert">
        ‚ùå An error occurred. Please try again.
      </div>
    </div>

    <script>
      function loadSettings() {
        // Load statistics
        const stats = JSON.parse(
          localStorage.getItem("focusStats") ||
            '{"sessionsToday": 0, "totalFocusTime": 0, "currentStreak": 0}'
        );
        const completedTasks = JSON.parse(
          localStorage.getItem("completedTasks") || "[]"
        );

        document.getElementById("totalSessions").textContent =
          stats.sessionsToday;
        document.getElementById("totalFocusTime").textContent =
          Math.round(stats.totalFocusTime / 3600) + "h";
        document.getElementById("totalTasks").textContent =
          completedTasks.length;

        // Load settings
        const settings = JSON.parse(localStorage.getItem("settings") || "{}");
        if (settings.timezone)
          document.getElementById("timezone").value = settings.timezone;
        if (settings.theme)
          document.getElementById("theme").value = settings.theme;
        if (settings.focusDuration)
          document.getElementById("focusDuration").value =
            settings.focusDuration;
        if (settings.breakDuration)
          document.getElementById("breakDuration").value =
            settings.breakDuration;

        document.getElementById("notifications").checked =
          settings.notifications !== false;
        document.getElementById("sounds").checked = settings.sounds !== false;
        document.getElementById("autoBreak").checked =
          settings.autoBreak === true;
      }

      function saveSettings() {
        const settings = {
          timezone: document.getElementById("timezone").value,
          theme: document.getElementById("theme").value,
          notifications: document.getElementById("notifications").checked,
          sounds: document.getElementById("sounds").checked,
          focusDuration: parseInt(
            document.getElementById("focusDuration").value
          ),
          breakDuration: parseInt(
            document.getElementById("breakDuration").value
          ),
          autoBreak: document.getElementById("autoBreak").checked,
        };

        localStorage.setItem("settings", JSON.stringify(settings));
        showAlert("success");
      }

      function resetStats() {
        if (
          confirm(
            "Are you sure you want to reset all statistics? This cannot be undone."
          )
        ) {
          localStorage.setItem(
            "focusStats",
            JSON.stringify({
              sessionsToday: 0,
              totalFocusTime: 0,
              currentStreak: 0,
            })
          );
          loadSettings();
          showAlert("success");
        }
      }

      function exportData() {
        const data = {
          schedule: JSON.parse(localStorage.getItem("todaySchedule") || "[]"),
          completedTasks: JSON.parse(
            localStorage.getItem("completedTasks") || "[]"
          ),
          focusStats: JSON.parse(localStorage.getItem("focusStats") || "{}"),
          settings: JSON.parse(localStorage.getItem("settings") || "{}"),
          exportDate: new Date().toISOString(),
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `taskpilot-backup-${
          new Date().toISOString().split("T")[0]
        }.json`;
        a.click();
        URL.revokeObjectURL(url);

        showAlert("success");
      }

      function importData() {
        const file = document.getElementById("importFile").files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);

            if (data.schedule)
              localStorage.setItem(
                "todaySchedule",
                JSON.stringify(data.schedule)
              );
            if (data.completedTasks)
              localStorage.setItem(
                "completedTasks",
                JSON.stringify(data.completedTasks)
              );
            if (data.focusStats)
              localStorage.setItem(
                "focusStats",
                JSON.stringify(data.focusStats)
              );
            if (data.settings)
              localStorage.setItem("settings", JSON.stringify(data.settings));

            loadSettings();
            showAlert("success");
          } catch (error) {
            showAlert("error");
          }
        };
        reader.readAsText(file);
      }

      function clearAllData() {
        if (
          confirm(
            "‚ö†Ô∏è WARNING: This will delete ALL your data including tasks, statistics, and settings. This cannot be undone. Are you absolutely sure?"
          )
        ) {
          if (
            confirm("Last chance! Click OK to permanently delete everything.")
          ) {
            localStorage.clear();
            loadSettings();
            showAlert("success");
            setTimeout(() => location.reload(), 1500);
          }
        }
      }

      function showAlert(type) {
        const alert = document.getElementById(type + "Alert");
        alert.classList.add("show");
        setTimeout(() => {
          alert.classList.remove("show");
        }, 3000);
      }

      // Auto-save settings on change
      document
        .querySelectorAll(
          'select, input[type="checkbox"], input[type="number"]'
        )
        .forEach((element) => {
          element.addEventListener("change", saveSettings);
        });

      loadSettings();
    </script>
  </body>
</html>
